{"version":3,"sources":["../../socketIO/server_socket.js"],"names":["require","ChatModel","module","exports","server","io","on","socket","content","from","to","console","log","chat_id","sort","join","create_time","Date","now","save","error","chatMsg","emit"],"mappings":";;eACkBA,QAAQ,cAAR,C;IAAXC,S,YAAAA,S;;AACPC,OAAOC,OAAP,GAAe,UAAUC,MAAV,EAAkB;AAC/B,MAAMC,KAAKL,QAAQ,WAAR,EAAqBI,MAArB,CAAX;AACA;AACAC,KAAGC,EAAH,CAAM,YAAN,EAAoB,UAAUC,MAAV,EAAkB;AACtC;AACE;AACAA,WAAOD,EAAP,CAAU,SAAV,EAAqB,gBAA6B;AAAA,UAAlBE,OAAkB,QAAlBA,OAAkB;AAAA,UAAVC,IAAU,QAAVA,IAAU;AAAA,UAALC,EAAK,QAALA,EAAK;;AACjDC,cAAQC,GAAR,CAAY,cAAZ,EAA4B,EAACJ,gBAAD,EAASC,UAAT,EAAcC,MAAd,EAA5B;AACC,UAAMG,UAAQ,CAACJ,IAAD,EAAMC,EAAN,EAAUI,IAAV,GAAiBC,IAAjB,CAAsB,GAAtB,CAAd;AACA,UAAMC,cAAYC,KAAKC,GAAL,EAAlB;;AAEA,UAAIjB,SAAJ,CAAc,EAACO,gBAAD,EAASC,UAAT,EAAcC,MAAd,EAAiBG,gBAAjB,EAAyBG,wBAAzB,EAAd,EAAqDG,IAArD,CAA0D,UAAUC,KAAV,EAAgBC,OAAhB,EAAyB;AACjFhB,WAAGiB,IAAH,CAAQ,YAAR,EAAsBD,OAAtB;AACE,OAFJ;AAGC,KARH;AASD,GAZD;AAaD,CAhBD","file":"server_socket.js","sourcesContent":["\r\nconst {ChatModel}=require('../db/models')\r\nmodule.exports=function (server) {\r\n  const io = require('socket.io')(server)\r\n  // 监视连接(当有一个客户连接上时回调)\r\n  io.on('connection', function (socket) {\r\n  //  console.log('soketio connected')\r\n    // 绑定sendMsg监听, 接收客户端发送的消息\r\n    socket.on('sendMsg', function ({content,from,to}) {\r\n     console.log('服务器接收到浏览器的消息', {content,from,to})\r\n      const chat_id=[from,to].sort().join('_');\r\n      const create_time=Date.now();\r\n\r\n      new ChatModel({content,from,to,chat_id,create_time}).save(function (error,chatMsg) {\r\n        io.emit('receiveMsg', chatMsg)\r\n         })\r\n      })\r\n  })\r\n}"]}